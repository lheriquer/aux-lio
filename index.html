<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#21C25E">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="PicPay">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="picpay-icon-512.png">
<title>Painel Game</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}
body{background:radial-gradient(circle at top,#2b0000,#000);min-height:100vh;display:flex;align-items:center;justify-content:center;color:#fff;padding:20px}
.hidden{display:none!important}
.card{width:100%;max-width:380px;background:#0f0f0f;border-radius:20px;padding:20px;box-shadow:0 0 30px rgba(255,0,0,.4);animation:fade .5s}
@keyframes fade{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
.avatar{display:flex;justify-content:center;margin-bottom:15px;cursor:pointer;-webkit-tap-highlight-color:transparent}
.avatar img{width:85px;height:85px;border-radius:50%;border:3px solid red;box-shadow:0 0 20px red;object-fit:cover;transition:transform .3s}
.avatar img:hover{transform:scale(1.05)}
h3{text-align:center;margin-bottom:15px;font-weight:700}
input,select{width:100%;padding:12px;border:none;border-radius:12px;margin-top:10px;background:#1b1b1b;color:#fff;font-size:15px;outline:none;transition:all .3s}
input:focus,select:focus{background:#252525;box-shadow:0 0 10px rgba(255,0,0,.3)}
input::placeholder{color:#666}
button{width:100%;padding:14px;margin-top:15px;background:red;border:none;border-radius:14px;font-size:15px;font-weight:bold;color:#fff;cursor:pointer;transition:all .3s}
button:hover{background:#ff1a1a;transform:translateY(-2px);box-shadow:0 5px 15px rgba(255,0,0,.4)}
button:active{transform:translateY(0)}

/* OP√á√ïES MELHORADAS - MUITO CAPA */
.option{
  background:linear-gradient(145deg,#1f1f1f 0%,#0a0a0a 100%);
  padding:16px 18px;
  border-radius:18px;
  margin-bottom:16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  transition:all .5s cubic-bezier(0.34,1.56,0.64,1);
  border:2px solid #1a1a1a;
  box-shadow:0 8px 16px rgba(0,0,0,.4),inset 0 1px 0 rgba(255,255,255,.05);
  position:relative;
  overflow:hidden;
}
.option::before{
  content:"";
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg,transparent,rgba(255,0,0,.1),transparent);
  transition:.6s;
}
.option:hover::before{left:100%}
.option:hover{
  background:linear-gradient(145deg,#2a0000 0%,#150000 100%);
  transform:translateX(8px) scale(1.03);
  border-color:#ff0000;
  box-shadow:0 12px 30px rgba(255,0,0,.3),0 0 40px rgba(255,0,0,.2),inset 0 1px 0 rgba(255,0,0,.2);
}
.option:active{transform:translateX(5px) scale(1.01)}
.option span{
  font-size:15px;
  font-weight:600;
  letter-spacing:.5px;
  text-shadow:0 2px 8px rgba(0,0,0,.8);
  transition:.3s;
}
.option:hover span{color:#fff;text-shadow:0 0 10px rgba(255,0,0,.5)}
.option.active{
  border-color:#ff0000;
  background:linear-gradient(145deg,#330000 0%,#1a0000 100%);
  box-shadow:0 0 30px rgba(255,0,0,.5),0 8px 20px rgba(0,0,0,.4),inset 0 2px 10px rgba(255,0,0,.2);
}

/* TOGGLE MUITO MELHORADO */
.toggle{
  width:56px;
  height:30px;
  background:linear-gradient(145deg,#2a2a2a,#1a1a1a);
  border-radius:30px;
  position:relative;
  transition:all .5s;
  flex-shrink:0;
  border:2px solid #333;
  box-shadow:inset 0 3px 6px rgba(0,0,0,.6),0 2px 4px rgba(0,0,0,.3);
}
.toggle::before{
  content:"";
  width:24px;
  height:24px;
  background:linear-gradient(145deg,#f5f5f5,#ddd);
  border-radius:50%;
  position:absolute;
  top:1px;
  left:2px;
  transition:.5s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow:0 4px 12px rgba(0,0,0,.5),inset 0 -2px 4px rgba(0,0,0,.1);
}
.toggle.active{
  background:linear-gradient(145deg,#ff0000,#aa0000);
  border-color:#ff3333;
  box-shadow:0 0 20px rgba(255,0,0,.6),inset 0 3px 6px rgba(0,0,0,.3),0 4px 8px rgba(255,0,0,.4);
}
.toggle.active::before{
  left:28px;
  background:linear-gradient(145deg,#fff,#f0f0f0);
  box-shadow:0 4px 16px rgba(255,0,0,.8),inset 0 -2px 4px rgba(0,0,0,.1);
}

.status-bar{margin-top:15px;padding:12px;background:linear-gradient(145deg,#1a1a1a,#0d0d0d);border-radius:12px;font-size:13px;text-align:center;color:#aaa;border:1px solid #222;box-shadow:inset 0 2px 4px rgba(0,0,0,.4)}
.status-indicator{display:inline-block;width:9px;height:9px;border-radius:50%;background:#0f0;margin-right:8px;animation:pulse 2s infinite;box-shadow:0 0 10px #0f0}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(1.3)}}

button.secondary{background:#333;margin-top:10px}
button.secondary:hover{background:#444}

/* BOT√ÉO RESETAR ACESSO */
button.reset{
  background:linear-gradient(135deg,#ff6600,#cc4400)!important;
  margin-top:15px;
  position:relative;
  overflow:hidden;
  border:2px solid #ff8833;
  box-shadow:0 4px 15px rgba(255,102,0,.4);
}
button.reset:hover{
  background:linear-gradient(135deg,#ff8833,#ff6600)!important;
  transform:translateY(-3px);
  box-shadow:0 6px 20px rgba(255,102,0,.6);
}
button.reset::before{
  content:"";
  position:absolute;
  top:50%;
  left:50%;
  width:0;
  height:0;
  border-radius:50%;
  background:rgba(255,255,255,.3);
  transform:translate(-50%,-50%);
  transition:.5s;
}
button.reset:hover::before{width:300px;height:300px}

.badge{display:inline-block;color:#fff;padding:3px 8px;border-radius:5px;font-size:11px;font-weight:bold;margin-left:8px}
.badge.owner{background:gold;color:#000}
.badge.admin{background:red}
.badge.user{background:#666}
.info-text{background:#111;padding:10px;border-radius:8px;font-size:12px;color:#aaa;margin-top:10px;text-align:center}
.user-item{background:#141414;padding:12px;border-radius:12px;margin-bottom:10px}
.user-email{font-size:14px;font-weight:500;margin-bottom:5px;color:#fff;word-break:break-all}
.user-info{font-size:12px;color:#aaa;margin-bottom:8px}
.user-actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
.user-actions button{padding:8px;margin:0;font-size:12px}
.pending-count{background:red;color:#fff;padding:2px 6px;border-radius:10px;font-size:11px;margin-left:5px}
.approved-tag{display:inline-block;background:#0a0;color:#fff;padding:2px 6px;border-radius:4px;font-size:10px;margin-left:5px}
.expired-tag{display:inline-block;background:#666;color:#fff;padding:2px 6px;border-radius:4px;font-size:10px;margin-left:5px}

/* C√ìDIGO DE VERIFICA√á√ÉO */
.code-inputs{display:flex;gap:8px;justify-content:center;margin:20px 0}
.code-input{width:45px;height:55px;text-align:center;font-size:24px;font-weight:bold;background:#1b1b1b;border:2px solid #333;border-radius:10px;color:#fff;transition:.3s}
.code-input:focus{border-color:#ff0000;background:#252525;box-shadow:0 0 15px rgba(255,0,0,.4);outline:none}
.warning-box{background:#330000;border:2px solid #ff0000;border-radius:12px;padding:15px;margin:15px 0;font-size:13px;line-height:1.6}
.warning-box strong{color:#ff6666;display:block;margin-bottom:8px;font-size:14px}
.timer{color:#ff6666;font-weight:bold;font-size:16px;margin-top:10px;text-align:center}
</style>
</head>
<body>

<!-- TELA DE LOGIN -->
<div class="card" id="login">
  <div class="avatar"><img src="avatar.jpg" alt="Avatar"></div>
  <h3>Login</h3>
  <input type="email" id="emailInput" placeholder="Digite seu email">
  <button onclick="login()">Entrar</button>
  <button class="secondary" id="btnInstall" onclick="instalar()">üì≤ Instalar App</button>
  <div class="info-text">Digite seu email para acessar</div>
</div>

<!-- TELA DE VERIFICA√á√ÉO DE C√ìDIGO -->
<div class="card hidden" id="verify">
  <div class="avatar"><img src="avatar.jpg" alt="Avatar"></div>
  <h3>Verifica√ß√£o de Dispositivo</h3>
  
  <div class="warning-box">
    <strong>‚ö†Ô∏è Novo dispositivo detectado!</strong>
    Verifique seu email (incluindo spam) e digite o c√≥digo de 6 d√≠gitos abaixo.
  </div>
  
  <div class="code-inputs">
    <input type="text" maxlength="1" class="code-input" id="c1" oninput="moveNext(this,1)" onkeydown="movePrev(event,this,1)">
    <input type="text" maxlength="1" class="code-input" id="c2" oninput="moveNext(this,2)" onkeydown="movePrev(event,this,2)">
    <input type="text" maxlength="1" class="code-input" id="c3" oninput="moveNext(this,3)" onkeydown="movePrev(event,this,3)">
    <input type="text" maxlength="1" class="code-input" id="c4" oninput="moveNext(this,4)" onkeydown="movePrev(event,this,4)">
    <input type="text" maxlength="1" class="code-input" id="c5" oninput="moveNext(this,5)" onkeydown="movePrev(event,this,5)">
    <input type="text" maxlength="1" class="code-input" id="c6" oninput="moveNext(this,6)" onkeydown="movePrev(event,this,6)">
  </div>
  
  <div class="timer">Expira em: <span id="timeLeft">15:00</span></div>
  
  <button onclick="verificarCodigo()">Verificar C√≥digo</button>
  <button class="secondary" onclick="voltarLogin()">Voltar</button>
  
  <div class="info-text" style="margin-top:15px;font-size:11px">
    O c√≥digo expira em 15 minutos. N√£o compartilhe com ningu√©m!
  </div>
</div>

<!-- PAINEL PRINCIPAL -->
<div class="card hidden" id="panel">
  <div class="avatar" onclick="checkOwner()"><img src="avatar.jpg" alt="Avatar"></div>
  <h3 id="panelTitle">Painel de Controle</h3>
  
  <div class="option" onclick="toggle(this,'aim')">
    <span>üéØ Aim Assist</span>
    <div class="toggle"></div>
  </div>
  
  <div class="option" onclick="toggle(this,'sens')">
    <span>‚ö° Sensibilidade++</span>
    <div class="toggle"></div>
  </div>
  
  <div class="option" onclick="toggle(this,'rec')">
    <span>üéÆ Controle de Recuo</span>
    <div class="toggle"></div>
  </div>
  
  <div class="status-bar">
    <span class="status-indicator"></span>
    <span id="status">Sistema Pronto</span>
  </div>
  
  <button onclick="aplicar()">‚ú® Aplicar Configura√ß√µes</button>
  <button onclick="abrirFF()">üî• Abrir Free Fire</button>
  
  <!-- BOT√ÉO RESETAR - S√ì NO APP -->
  <button class="reset hidden" id="btnReset" onclick="resetarAcesso()">üîÑ Resetar Acesso</button>
  
  <!-- BOT√ÉO SAIR - S√ì NO NAVEGADOR -->
  <button class="secondary hidden" id="btnSair" onclick="sair()">üö™ Sair</button>
</div>

<!-- PAINEL DO DONO -->
<div class="card hidden" id="owner">
  <div class="avatar"><img src="avatar.jpg" alt="Avatar"></div>
  <h3>Gerenciar Acessos <span class="badge owner">DONO</span></h3>
  <div style="margin-bottom:15px">
    <button onclick="showPend()">Pendentes <span class="pending-count" id="pCount">0</span></button>
    <button class="secondary" onclick="showAprov()">Aprovados</button>
  </div>
  <div id="pList"></div>
  <div id="aList" class="hidden"></div>
  <button class="secondary" onclick="voltar()">Voltar ao Painel</button>
</div>

<script>
const CFG={owner:'lheriquer21@gmail.com',clicks:0,user:null,s:{aim:0,sens:0,rec:0},deviceId:null,verifyEmail:null,verifyCode:null,codeExpiry:null,timerInterval:null};

function getDeviceId(){
  let id=localStorage.getItem('deviceId');
  if(!id){
    id='dev_'+Date.now()+'_'+Math.random().toString(36).substr(2,9);
    localStorage.setItem('deviceId',id);
  }
  return id;
}

function isInstalledApp(){
  return window.matchMedia('(display-mode: standalone)').matches||window.navigator.standalone===true;
}

function updateButtons(){
  const installed=isInstalledApp();
  const btnInstall=document.getElementById('btnInstall');
  const btnReset=document.getElementById('btnReset');
  const btnSair=document.getElementById('btnSair');
  
  if(installed){
    if(btnInstall)btnInstall.classList.add('hidden');
    if(btnReset)btnReset.classList.remove('hidden');
    if(btnSair)btnSair.classList.add('hidden');
  }else{
    if(btnInstall)btnInstall.classList.remove('hidden');
    if(btnReset)btnReset.classList.add('hidden');
    if(btnSair)btnSair.classList.remove('hidden');
  }
}

function gerarCodigo(){
  return Math.floor(100000+Math.random()*900000).toString();
}

function login(){
  let e=document.getElementById('emailInput').value.trim().toLowerCase();
  if(!e){
    document.getElementById('emailInput').style.border='2px solid red';
    setTimeout(()=>document.getElementById('emailInput').style.border='',2000);
    return;
  }
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){
    document.getElementById('emailInput').style.border='2px solid red';
    let msg=document.createElement('div');
    msg.className='info-text';
    msg.style.background='#a00';
    msg.textContent='Email inv√°lido!';
    document.getElementById('login').appendChild(msg);
    setTimeout(()=>{msg.remove();document.getElementById('emailInput').style.border=''},2000);
    return;
  }
  
  if(e===CFG.owner){
    CFG.user={email:e,role:'owner',at:Date.now(),deviceId:getDeviceId()};
    save();show();return;
  }
  
  let u=getU().find(x=>x.email===e);
  if(u){
    if(u.exp&&new Date(u.exp)<new Date()){
      document.getElementById('emailInput').value='';
      let msg=document.createElement('div');
      msg.className='info-text';
      msg.style.background='#a00';
      msg.textContent='Acesso expirado! ‚è∞';
      document.getElementById('login').appendChild(msg);
      setTimeout(()=>msg.remove(),3000);
      return;
    }
    
    const currentDevice=getDeviceId();
    if(u.deviceId&&u.deviceId!==currentDevice){
      mostrarVerificacao(e);
      return;
    }
    
    u.deviceId=currentDevice;
    CFG.user=u;
    save();
    saveUserDevice(e,currentDevice);
    show();
  }else{
    let p=getP();
    if(p.find(x=>x.email===e)){
      document.getElementById('emailInput').value='';
      let msg=document.createElement('div');
      msg.className='info-text';
      msg.textContent='Solicita√ß√£o j√° enviada! Aguarde aprova√ß√£o ‚è≥';
      document.getElementById('login').appendChild(msg);
      setTimeout(()=>msg.remove(),3000);
      return;
    }
    p.push({email:e,at:Date.now()});
    localStorage.setItem('p',JSON.stringify(p));
    document.getElementById('emailInput').value='';
    let msg=document.createElement('div');
    msg.className='info-text';
    msg.style.background='#0a0';
    msg.textContent='Solicita√ß√£o enviada com sucesso! ‚úÖ';
    document.getElementById('login').appendChild(msg);
    setTimeout(()=>msg.remove(),3000);
  }
}

function mostrarVerificacao(email){
  CFG.verifyEmail=email;
  CFG.verifyCode=gerarCodigo();
  CFG.codeExpiry=Date.now()+(15*60*1000);
  
  console.log('C√ìDIGO:',CFG.verifyCode,'Email:',email);
  
  document.getElementById('login').classList.add('hidden');
  document.getElementById('verify').classList.remove('hidden');
  document.getElementById('c1').focus();
  startTimer();
  
  let msg=document.createElement('div');
  msg.className='info-text';
  msg.style.background='#0a0';
  msg.style.position='fixed';
  msg.style.top='20px';
  msg.style.left='50%';
  msg.style.transform='translateX(-50%)';
  msg.style.zIndex='9999';
  msg.style.maxWidth='90%';
  msg.textContent=`üìß C√≥digo: ${CFG.verifyCode}`;
  document.body.appendChild(msg);
  setTimeout(()=>msg.remove(),8000);
}

function startTimer(){
  if(CFG.timerInterval)clearInterval(CFG.timerInterval);
  CFG.timerInterval=setInterval(()=>{
    const remaining=CFG.codeExpiry-Date.now();
    if(remaining<=0){
      clearInterval(CFG.timerInterval);
      document.getElementById('timeLeft').textContent='EXPIRADO';
      document.getElementById('timeLeft').style.color='#ff0000';
      return;
    }
    const mins=Math.floor(remaining/60000);
    const secs=Math.floor((remaining%60000)/1000);
    document.getElementById('timeLeft').textContent=`${mins}:${secs.toString().padStart(2,'0')}`;
  },1000);
}

function moveNext(el,num){
  el.value=el.value.replace(/[^0-9]/g,'');
  if(el.value.length===1&&num<6){
    document.getElementById('c'+(num+1)).focus();
  }
  if(num===6&&el.value.length===1){
    setTimeout(verificarCodigo,300);
  }
}

function movePrev(e,el,num){
  if(e.key==='Backspace'&&el.value.length===0&&num>1){
    document.getElementById('c'+(num-1)).focus();
  }
}

function verificarCodigo(){
  if(Date.now()>CFG.codeExpiry){
    let msg=document.createElement('div');
    msg.className='info-text';
    msg.style.background='#a00';
    msg.textContent='C√≥digo expirado! Tente novamente.';
    document.getElementById('verify').appendChild(msg);
    setTimeout(()=>{msg.remove();voltarLogin()},2000);
    return;
  }
  
  const codigo=
    document.getElementById('c1').value+
    document.getElementById('c2').value+
    document.getElementById('c3').value+
    document.getElementById('c4').value+
    document.getElementById('c5').value+
    document.getElementById('c6').value;
  
  if(codigo.length!==6){
    let msg=document.createElement('div');
    msg.className='info-text';
    msg.style.background='#a00';
    msg.textContent='Digite os 6 d√≠gitos!';
    document.getElementById('verify').appendChild(msg);
    setTimeout(()=>msg.remove(),2000);
    return;
  }
  
  if(codigo===CFG.verifyCode){
    clearInterval(CFG.timerInterval);
    const newDevice=getDeviceId();
    let u=getU().find(x=>x.email===CFG.verifyEmail);
    u.deviceId=newDevice;
    CFG.user=u;
    save();
    saveUserDevice(CFG.verifyEmail,newDevice);
    CFG.verifyEmail=null;
    CFG.verifyCode=null;
    CFG.codeExpiry=null;
    document.getElementById('verify').classList.add('hidden');
    show();
  }else{
    let msg=document.createElement('div');
    msg.className='info-text';
    msg.style.background='#a00';
    msg.textContent='‚ùå C√≥digo incorreto!';
    document.getElementById('verify').appendChild(msg);
    setTimeout(()=>msg.remove(),2000);
    for(let i=1;i<=6;i++){
      document.getElementById('c'+i).value='';
    }
    document.getElementById('c1').focus();
  }
}

function voltarLogin(){
  if(CFG.timerInterval)clearInterval(CFG.timerInterval);
  CFG.verifyEmail=null;
  CFG.verifyCode=null;
  CFG.codeExpiry=null;
  document.getElementById('verify').classList.add('hidden');
  document.getElementById('login').classList.remove('hidden');
  for(let i=1;i<=6;i++){
    document.getElementById('c'+i).value='';
  }
}

function resetarAcesso(){
  if(!CFG.user)return;
  const lastReset=localStorage.getItem('lastReset_'+CFG.user.email);
  if(lastReset){
    const diff=Date.now()-parseInt(lastReset);
    const hours=diff/(1000*60*60);
    if(hours<24){
      const remaining=Math.ceil(24-hours);
      let msg=document.createElement('div');
      msg.className='warning-box';
      msg.innerHTML=`<strong>‚è∞ Aguarde ${remaining}h</strong>Voc√™ pode resetar apenas 1 vez por dia.`;
      document.getElementById('panel').insertBefore(msg,document.getElementById('panel').firstChild);
      setTimeout(()=>msg.remove(),4000);
      return;
    }
  }
  
  const box=document.createElement('div');
  box.className='warning-box';
  box.innerHTML=`
    <strong>‚ö†Ô∏è Importante:</strong>
    ‚Ä¢ Voc√™ pode resetar seu acesso apenas 1 vez por dia<br>
    ‚Ä¢ O c√≥digo expira em 15 minutos<br>
    ‚Ä¢ Ap√≥s o reset, voc√™ poder√° fazer login em um novo dispositivo
  `;
  document.getElementById('panel').insertBefore(box,document.getElementById('panel').firstChild);
  
  const btnConfirm=document.createElement('button');
  btnConfirm.textContent='‚úÖ Confirmar Reset';
  btnConfirm.style.marginTop='10px';
  btnConfirm.onclick=()=>{
    localStorage.setItem('lastReset_'+CFG.user.email,Date.now().toString());
    let users=getU();
    let u=users.find(x=>x.email===CFG.user.email);
    if(u){
      delete u.deviceId;
      localStorage.setItem('u',JSON.stringify(users));
    }
    box.remove();
    btnConfirm.remove();
    let msg=document.createElement('div');
    msg.className='info-text';
    msg.style.background='#0a0';
    msg.textContent='‚úÖ Acesso resetado! Agora voc√™ pode fazer login em outro dispositivo.';
    document.getElementById('panel').insertBefore(msg,document.getElementById('panel').firstChild);
    setTimeout(()=>msg.remove(),4000);
  };
  document.getElementById('panel').insertBefore(btnConfirm,box.nextSibling);
}

function saveUserDevice(email,deviceId){
  let users=getU();
  let u=users.find(x=>x.email===email);
  if(u){
    u.deviceId=deviceId;
    localStorage.setItem('u',JSON.stringify(users));
  }
}

function show(){
  document.getElementById('login').classList.add('hidden');
  document.getElementById('verify').classList.add('hidden');
  document.getElementById('panel').classList.remove('hidden');
  let t='Painel de Controle';
  if(CFG.user.role==='owner')t+=' <span class="badge owner">DONO</span>';
  else if(CFG.user.role==='admin')t+=' <span class="badge admin">ADMIN</span>';
  document.getElementById('panelTitle').innerHTML=t;
  updateButtons();
}

function checkOwner(){
  if(CFG.user&&CFG.user.role==='owner'){
    CFG.clicks++;
    if(CFG.clicks>=5){
      CFG.clicks=0;
      showOwn();
    }else{
      document.getElementById('status').textContent=(5-CFG.clicks)+' cliques restantes';
    }
  }
}

function toggle(el,k){
  const t=el.querySelector('.toggle');
  t.classList.toggle('active');
  el.classList.toggle('active');
  CFG.s[k]=t.classList.contains('active');
  const names={aim:'Aim Assist',sens:'Sensibilidade',rec:'Controle de Recuo'};
  document.getElementById('status').textContent=names[k]+' '+(CFG.s[k]?'ATIVADO ‚úÖ':'DESATIVADO ‚≠ï');
}

function aplicar(){
  if(!CFG.s.aim&&!CFG.s.sens&&!CFG.s.rec){
    document.getElementById('status').textContent='‚ö†Ô∏è Ative pelo menos uma op√ß√£o!';
    setTimeout(()=>document.getElementById('status').textContent='Sistema Pronto',2500);
    return;
  }
  document.getElementById('status').textContent='‚öôÔ∏è Aplicando...';
  setTimeout(()=>{
    document.getElementById('status').textContent='‚úÖ Configura√ß√µes aplicadas!';
    if(navigator.vibrate)navigator.vibrate([100,50,100,50,100]);
  },1500);
}

function abrirFF(){
  let p='com.dts.freefireth';
  document.getElementById('status').textContent='üî• Abrindo Free Fire...';
  window.location.href=`intent://${p}#Intent;scheme=android-app;package=${p};S.browser_fallback_url=about:blank;end`;
  setTimeout(()=>{
    document.getElementById('status').textContent='üéÆ Free Fire aberto!';
    if(navigator.vibrate)navigator.vibrate([100,50,100]);
  },1000);
}

function instalar(){
  if(isInstalledApp()){
    document.getElementById('status').textContent='‚úÖ App j√° instalado!';
    return;
  }
  let msg='';
  if(/iPad|iPhone|iPod/.test(navigator.userAgent)){
    msg='üì± iOS: Compartilhar (‚Üë) > Adicionar √† Tela Inicial';
  }else if(/Android/.test(navigator.userAgent)){
    msg='üì± Android: Menu (‚ãÆ) > Instalar app';
  }else{
    msg='üíª Desktop: √çcone (+) na barra de endere√ßo';
  }
  let el=document.createElement('div');
  el.className='info-text';
  el.style.background='#1a1a1a';
  el.textContent=msg;
  document.getElementById('login').appendChild(el);
  setTimeout(()=>el.remove(),6000);
}

function sair(){
  localStorage.removeItem('cu');
  CFG.user=null;
  CFG.s={aim:0,sens:0,rec:0};
  document.getElementById('panel').classList.add('hidden');
  document.getElementById('owner').classList.add('hidden');
  document.getElementById('login').classList.remove('hidden');
  document.getElementById('emailInput').value='';
  document.getElementById('status').textContent='Sistema Pronto';
  updateButtons();
}

function showOwn(){
  document.getElementById('panel').classList.add('hidden');
  document.getElementById('owner').classList.remove('hidden');
  showPend();
}

function showPend(){
  let p=getP(),c=p.length;
  document.getElementById('pCount').textContent=c;
  document.getElementById('pList').classList.remove('hidden');
  document.getElementById('aList').classList.add('hidden');
  if(c===0){
    document.getElementById('pList').innerHTML='<div class="info-text">Nenhuma solicita√ß√£o</div>';
    return;
  }
  let h='';
  p.forEach((u,i)=>{
    let d=new Date(u.at).toLocaleString('pt-BR');
    h+=`<div class="user-item">
      <div class="user-email">${u.email}</div>
      <div class="user-info">Em: ${d}</div>
      <select id="r${i}"><option value="user">Usu√°rio</option><option value="admin">Admin</option></select>
      <select id="d${i}"><option value="1">1 dia</option><option value="7">7 dias</option><option value="30">30 dias</option><option value="365">1 ano</option><option value="99999">Permanente</option></select>
      <div class="user-actions">
        <button onclick="aprov('${u.email}',${i})">Aprovar</button>
        <button class="secondary" onclick="reject('${u.email}')">Rejeitar</button>
      </div>
    </div>`;
  });
  document.getElementById('pList').innerHTML=h;
}

function showAprov(){
  let u=getU();
  document.getElementById('pList').classList.add('hidden');
  document.getElementById('aList').classList.remove('hidden');
  if(u.length===0){
    document.getElementById('aList').innerHTML='<div class="info-text">Nenhum aprovado</div>';
    return;
  }
  let h='';
  u.forEach(x=>{
    let d=new Date(x.at).toLocaleString('pt-BR');
    let e='';
    if(x.exp){
      let de=new Date(x.exp);
      e=de<new Date()?'<span class="expired-tag">EXPIRADO</span>':'<span class="approved-tag">'+de.toLocaleDateString('pt-BR')+'</span>';
    }else{
      e='<span class="approved-tag">PERMANENTE</span>';
    }
    let r=x.role==='admin'?'Admin':'Usu√°rio';
    let dev=x.deviceId?'<div class="user-info">üîí '+x.deviceId.substr(0,20)+'...</div>':'';
    h+=`<div class="user-item">
      <div class="user-email">${x.email} <span class="badge ${x.role}">${r}</span></div>
      <div class="user-info">Em: ${d} ${e}</div>
      ${dev}
      <div class="user-actions">
        <button class="secondary" onclick="rem('${x.email}')">Remover</button>
      </div>
    </div>`;
  });
  document.getElementById('aList').innerHTML=h;
}

function aprov(e,i){
  let r=document.getElementById('r'+i).value;
  let ds=parseInt(document.getElementById('d'+i).value);
  let u=getU();
  let exp=ds===99999?null:new Date(Date.now()+ds*864e5).toISOString();
  u.push({email:e,role:r,at:new Date().toISOString(),exp:exp,deviceId:null});
  localStorage.setItem('u',JSON.stringify(u));
  let p=getP().filter(x=>x.email!==e);
  localStorage.setItem('p',JSON.stringify(p));
  showPend();
}

function reject(e){
  let p=getP().filter(x=>x.email!==e);
  localStorage.setItem('p',JSON.stringify(p));
  showPend();
}

function rem(e){
  let u=getU().filter(x=>x.email!==e);
  localStorage.setItem('u',JSON.stringify(u));
  showAprov();
}

function voltar(){
  document.getElementById('owner').classList.add('hidden');
  document.getElementById('panel').classList.remove('hidden');
}

function getU(){return JSON.parse(localStorage.getItem('u')||'[]')}
function getP(){return JSON.parse(localStorage.getItem('p')||'[]')}
function save(){localStorage.setItem('cu',JSON.stringify(CFG.user))}

window.onload=()=>{
  CFG.deviceId=getDeviceId();
  updateButtons();
  let s=localStorage.getItem('cu');
  if(s){
    CFG.user=JSON.parse(s);
    if(CFG.user.exp&&new Date(CFG.user.exp)<new Date()){
      localStorage.removeItem('cu');
      CFG.user=null;
      return;
    }
    if(CFG.user.deviceId&&CFG.user.deviceId!==CFG.deviceId){
      localStorage.removeItem('cu');
      CFG.user=null;
      return;
    }
    show();
  }
};

if('serviceWorker' in navigator){
  window.addEventListener('load',()=>navigator.serviceWorker.register('sw.js'));
}
</script>
</body>
</html>
